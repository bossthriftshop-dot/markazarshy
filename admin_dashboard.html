{% extends 'layout.html' %}

{% block title %}Dashboard Admin{% endblock %}

{% block content %}
<div class="mb-6">
    <h2 class="text-2xl font-bold mb-2 text-blue-700">Dashboard Admin</h2>
    <p class="text-gray-700">Daftar User Berlangganan dan Manajemen Lisensi.</p>
</div>
<div class="overflow-x-auto bg-white rounded-lg shadow-xl">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-blue-700 text-white">
            <tr>
                <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider">ID</th>
                <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider">Username</th>
                <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider">API Key</th>
                <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider">Status</th>
                <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider">Start Date</th>
                <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider">End Date</th>
                <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider">Aksi</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 text-gray-800">
            {% for user in users %}
            <tr class="{% if loop.index % 2 == 0 %}bg-gray-50{% else %}bg-white{% endif %} hover:bg-gray-100 transition duration-150">
                <td class="px-4 py-2 whitespace-nowrap text-sm">{{ user.id }}</td>
                <td class="px-4 py-2 whitespace-nowrap text-sm font-medium">{{ user.username }}</td>
                <td class="px-4 py-2 text-xs break-all font-mono">{{ user.api_key }}</td>
                <td class="px-4 py-2 whitespace-nowrap">
                    <span class="inline-block px-2 py-1 rounded-full {{ user.badge_class }} text-white text-xs font-semibold">
                        {{ user.status_text }}
                    </span>
                </td>
                <td class="px-4 py-2 whitespace-nowrap text-sm">{{ user.start_date }}</td>
                <td class="px-4 py-2 whitespace-nowrap text-sm">{{ user.end_date }}</td>
                <td class="px-4 py-2 whitespace-nowrap space-x-2 text-sm">
                    {% if user.proof_filename %}
                        <a href="{{ user.proof_url }}" target="_blank" class="text-blue-600 hover:underline font-medium">
                            <svg class="w-4 h-4 inline-block mr-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M14.293 15.707a1 1 0 01-1.414 1.414L10 12.414l-2.879 2.879a1 1 0 01-1.414-1.414L8.586 11H5a1 1 0 010-2h3.586L5.707 5.707a1 1 0 011.414-1.414L10 8.586l2.879-2.879a1 1 0 111.414 1.414L11.414 10l2.879 2.879zM10 18a8 8 0 100-16 8 8 0 000 16z" clip-rule="evenodd"></path></svg>
                            Bukti
                        </a>
                    {% endif %}
                    {% if user.status == "pending_activation" %}
                        <form action="{{ url_for('admin_activate_license', user_id=user.id) }}" method="post" class="inline" onsubmit="return confirm('Apakah Anda yakin ingin mengaktifkan lisensi ini?');">
                            <button type="submit" class="bg-green-600 text-white px-3 py-1.5 rounded-md hover:bg-green-700 text-xs font-semibold">
                                <svg class="w-4 h-4 inline-block mr-1" fill="currentColor" viewBox="0 0 20 20"><path d="M5 11l.942.942a.5.5 0 00.707 0l2.585-2.585a.5.5 0 00-.707-.707L7 10.293V5a1 1 0 10-2 0v5.293L2.707 7.707a.5.5 0 00-.707.707l2.585 2.585z"></path></svg>
                                Aktifkan
                            </button>
                        </form>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}